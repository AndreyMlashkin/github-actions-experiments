name: Demo CI

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  tests:
    name: Tests
    runs-on: ubuntu-latest
    steps:
      - name: Run tests
        run: echo "running tests"
      - name: Run tests 2
        run: echo "running test 2"

  deploy_test:
    name: Deploy Test
    runs-on: ubuntu-latest
    needs: tests
    environment:
      name: test
    env:
      IMPORTANT_SECRET: ${{ secrets.IMPORTANT_SECRET }}
      IMPORTANT_VAR: ${{ vars.IMPORTANT_VAR }}
    steps:
      - name: Validate environment wiring
        run: |
          test -n "$IMPORTANT_SECRET"
          test -n "$IMPORTANT_VAR"
      - name: Deploy to test
        run: echo "deploying to test"

  deploy_prod:
    name: Deploy Prod
    runs-on: ubuntu-latest
    needs: deploy_test
    environment:
      name: prod
    env:
      IMPORTANT_SECRET: ${{ secrets.IMPORTANT_SECRET }}
      IMPORTANT_VAR: ${{ vars.IMPORTANT_VAR }}
    steps:
      - name: Validate environment wiring
        run: |
          test -n "$IMPORTANT_SECRET"
          test -n "$IMPORTANT_VAR"
      - name: Deploy to prod
        run: echo "deploying to prod"
